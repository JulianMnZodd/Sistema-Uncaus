{% extends "_base.html" %}
{% load static %} 
{% block content %}

<div class="max-w-sm rounded overflow-hidden shadow-lg bg-white p-4">
    {% for habitacion in habitaciones %}
    <h2 class="text-xl font-bold mb-4 text-center">Habitación #{{ habitacion.numero }}</h2>
  <div class="grid grid-cols-2 gap-4">
    <!-- Reutilizar componente para camas -->
    {% for cama in habitacion.camas.all %}
      <div class="flex flex-col items-center border p-4 rounded-lg">
        <!-- Agregamos un ID para identificar cada cama -->
        <svg
          id="cama-{{ cama.idcama }}"
          fill="{% if cama.estado == 'O' %}#FF0000{% else %}#00FF00{% endif %}"
          height="150px"
          width="150px"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 511.998 511.998"
        >
        <g>
            <g>
              <path
                d="M235.561,335.822c-15.536,0-28.138-12.183-28.746-27.641c-0.253-6.419-0.302-12.887-0.119-19.576h-81.239
              c3.829-4.03,6.193-9.464,6.193-15.461c0-12.409-10.059-22.468-22.468-22.468h-0.313c15.053-3.356,26.432-16.645,26.728-32.747
              c0.347-18.884-14.682-34.475-33.567-34.821c-18.884-0.347-34.475,14.682-34.821,33.566c-0.303,16.526,11.168,30.529,26.694,34.002
              H52.657V136.21c0-6.283-5.093-11.376-11.376-11.376H11.376C5.093,124.834,0,129.927,0,136.21l0.199,219.577
              c0,7.755,6.288,14.043,14.043,14.043h24.474v8.229c0,5.028,4.076,9.104,9.104,9.104h45.669c5.028,0,9.104-4.076,9.104-9.104
              v-8.229H408.25v8.229c0,5.028,4.076,9.104,9.104,9.104h45.669c5.028,0,9.104-4.076,9.104-9.104v-8.229h21.509
              c7.755,0,14.043-6.288,14.043-14.043v-20.156C458.447,335.663,252.037,335.822,235.561,335.822z"
              />
            </g>
          </g>
          <g>
            <g>
              <path
                d="M320.098,214.364c-0.001-0.001-0.002-0.003-0.003-0.004c-4.804-7.754-15.006-10.108-22.711-5.337
              c-0.001,0-0.002,0.001-0.003,0.002l-48.526,30.055l-57.053-26.148l26.78,4.723c4.175-12.724,8.895-23.192,13.237-31.378
              l-62.089-1.14c-12.892-0.236-23.294,10.163-23.523,22.674l-0.756,41.192c-0.231,12.712,10.003,23.292,22.677,23.524l39.412,0.723
              c0.212-2.548,0.457-5.052,0.732-7.511l-28.126-21.845c0.247,0.114,63.004,28.875,63.004,28.875
              c4.798,2.198,10.74,2.012,15.561-0.974l56.047-34.714C322.536,232.265,324.881,222.086,320.098,214.364z"
              />
            </g>
          </g>
          <g>
            <g>
              <path
                d="M463.476,208.226c-62.726-18.113-164.001-31.505-201.971-30.431c0,0-12.598,14.513-22.559,43.451l6.706,1.182
              l43.387-26.873c14.998-9.289,34.99-4.931,44.525,10.466c9.365,15.118,4.772,35.091-10.466,44.526l-56.047,34.714
              c-13.218,8.188-27.946,4.425-33.623,0.017l-5.883-4.569c-0.503,8.387-0.643,17.255-0.272,26.666
              c0.175,4.45,3.831,7.971,8.285,7.971H497.76c4.068,0,7.537-2.95,8.189-6.965l5.294-32.56
              C516.415,244.021,494.427,217.163,463.476,208.226z"
              />
            </g>
          </g>
        </svg>
        <p class="text-gray-500" id="paciente-{{ cama.idcama }}">
            Paciente: <span class="font-bold">
            {% if cama.estado == 'L' %}
                Libre
            {% else %}
                {{ cama.paciente.idpaciente.nombre }}
            {% endif %}
            </span>
        </p>
        
        </div>
      {% endfor %}
  </div>

  {% endfor %}
</div>

        
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var socket = new WebSocket('ws://' + window.location.host + '/ws/camas/');
  
    socket.onopen = function(event) {
        console.log("WebSocket conectado.");
    };
  
    socket.onmessage = function(event) {
        console.log("Mensaje recibido: ", event.data);
        var data = JSON.parse(event.data);
        var camaId = data['idcama'];
        var estado = data['estado'];
        var paciente = data['paciente'];
  
        var camaSVG = document.getElementById('cama-' + camaId);
        if (camaSVG) {
            camaSVG.setAttribute('fill', estado === 'O' ? '#FF0000' : '#00FF00');  // Ejemplo de color basado en estado
        } else {
            console.log(`No se encontró el SVG para la cama ID=${camaId}`);
        }
  
        var pacienteInfo = document.getElementById('paciente-' + camaId);
        if (pacienteInfo) {
            pacienteInfo.innerHTML = 'Paciente: <span class="font-bold">' + (estado === 'Libre' ? 'Libre' : paciente) + '</span>';
        } else {
            console.log(`No se encontró el elemento paciente para la cama ID=${camaId}`);
        }
    };
  
    socket.onerror = function(error) {
        console.error("Error en WebSocket: ", error);
    };
  });
  </script>
  

{% endblock content %}